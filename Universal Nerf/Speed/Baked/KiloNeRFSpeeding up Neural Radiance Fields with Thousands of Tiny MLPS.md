# KiloNeRF:Speeding up Neural Radiance Fields with Thousands of Tiny MLPS

### Abstract

(感觉这几篇ICCV的故事点都是NeRF神经网络的查询次数过多，导致速度慢)

NeRF需要查询数百万次MLP，这使得渲染速度变慢，本文尝试用**数千个微型MLP**而不是单个大型的MLP来完成实时渲染，每个小的MLP只需要表示场景的一部分内容，利用了分治的方法进行结合，同时为了不牺牲视觉质量，使用了**师生蒸馏**的方法。

### Introduction

作者发现直接使用数千个微型MLP直接进行训练的话，会出现明显的伪影（分辨率比较低），为了克服这个问题，首先**训练出一个常规的NeRF**作为教师模型，之后**再训练这个KiloNeRF**，使得这个模型输出（颜色和密度）和这个教师模型的输出相匹配，最后**对原始训练图像进行微调**。

（补一嘴，这里还是有 **空白空间跳跃** 和 **早期光线终止**，看起来这是两个很有用也很必要的Trick)

### KiloNeRF

论文借鉴了AABB(axis aligned bounding box)的思路，将整个空间均匀划分为小体素，每个体素的索引$i = (i_x, i_y, i_z)$ ，然后每个这样的体素对应一个小的MLP模型，具体的位置和i的索引是通过函数$g(x)$分箱定义的：
$$
g(x) = [x - b_{min}/(b_{max} - b_{min})/r]
$$
上面公式的符号应该是下取整的符号，但是我这边不记得怎么打了，就先在这里说明下。

之后这样输出就变成了：
$$
(c, \sigma) = f_{\theta{(g(x))}}(x,d)
$$
**神经网络架构**

和原生NeRF并不完全一致，KiloNeRF的神经网络只有4个隐藏层和32个隐藏节点，同时不需要跳过连接，其他与原生NeRF的参数一致，除了倒数第二个隐藏层的特征向量没有激活函数，而最后对于颜色的激活函数是Sigmoid。

![image-20231028161234038](C:\Users\admin\AppData\Roaming\Typora\typora-user-images\image-20231028161234038.png)

**蒸馏训练**

首先在三维网格中随机采样一批3D点，然后在这些3D点随机从单位球体中采样一部分随机的观察方向，然后同时从学生和老师中跑一遍前向传播进行查询，获得各自的密度$\sigma$ 和颜色$c$ ，然后将$\sigma$ 转换为 $\alpha$ 作为损失反向梯度传播。
$$
\alpha_{i} = 1 - exp(\sigma_i\delta_i) \\
\delta_j =  ||x_{j+1} - x_{j}||
$$
然后损失函数是学生和老师的输出结果的L2正则化损失，注意它们是不跑渲染部分的，仅做神经网络的前向输出。

**正则化**

引用了一篇文章，认为NeRF对神经网络的处理鼓励了 颜色是观看方向的简单函数，所以为了增加该点密度有关特征的权重，在MLP最后两层应用了正则化。

**采样**

和Nerf一样等距采样，不过加入了 **空白空间跳跃**（为了不采样空白点） **早期光线终止**（为了不采样看不见的点），这样光线的采样数是可变的（因为没用的全部删掉的，每条光线无用的数量不一致），没有采用NeRF的分层采样方案。

编码方法是和Nerf本身一致的方法内容。

**个人认为，这篇的主要工作量在于开发底层的CUDA工作，不能使用传统的批处理矩阵乘法。**